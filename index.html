<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Rudved's Minecraft Birthday Quest</title>

<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

<style>
html,body{
  margin:0;
  padding:0;
  overflow:hidden;
  background:#87CEEB;
  touch-action:none;
  font-family:'Press Start 2P', cursive;
}

#instructions{
  position:fixed;
  top:0;
  width:100%;
  background:rgba(0,0,0,0.8);
  color:white;
  text-align:center;
  padding:10px;
  font-size:11px;
  z-index:50;
}

#inviteScreen{
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:rgba(0,0,0,0.95);
  color:white;
  display:none;
  justify-content:center;
  align-items:center;
  flex-direction:column;
  text-align:center;
  z-index:100;
}

.button{
  margin-top:20px;
  padding:15px;
  background:#00AAFF;
  border:none;
  color:white;
  font-family:'Press Start 2P';
}
</style>
</head>
<body>

<div id="instructions">
üéÇ Tap All 5 Floating Cakes! | Cakes Left: <span id="cakeCount">5</span>
</div>

<div id="inviteScreen">
<h2>üéâ You're Invited üéâ</h2>
<h1>Rudved's 8th Birthday!</h1>
<p>
üóì Saturday, 7th March<br><br>
‚è∞ 11:00 AM<br><br>
üéÆ Minecraft Fun Party
</p>
<button class="button" onclick="location.reload()">PLAY AGAIN</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

<script>
let scene=new THREE.Scene();
scene.background=new THREE.Color(0x87CEEB);

let renderer=new THREE.WebGLRenderer({antialias:true, powerPreference:"high-performance"});
renderer.setPixelRatio(Math.min(window.devicePixelRatio,2));
renderer.setSize(window.innerWidth,window.innerHeight);
document.body.appendChild(renderer.domElement);

let camera=new THREE.PerspectiveCamera(70,window.innerWidth/window.innerHeight,0.1,1000);
camera.position.set(0,12,28);
camera.lookAt(0,0,0);

window.addEventListener("resize",()=>{
camera.aspect=window.innerWidth/window.innerHeight;
camera.updateProjectionMatrix();
renderer.setSize(window.innerWidth,window.innerHeight);
});

scene.add(new THREE.AmbientLight(0xffffff,0.7));
let light=new THREE.DirectionalLight(0xffffff,1);
light.position.set(10,20,10);
scene.add(light);

/* ===== Minecraft Green Grass Floor ===== */

// Create canvas texture
let canvas = document.createElement('canvas');
canvas.width = 64;
canvas.height = 64;
let ctx = canvas.getContext('2d');

// Draw pixelated green pattern
for(let y=0; y<8; y++){
  for(let x=0; x<8; x++){
    ctx.fillStyle = (Math.random() > 0.5) ? "#2ecc40" : "#1e8c2f";
    ctx.fillRect(x*8, y*8, 8, 8);
  }
}

let grassTexture = new THREE.CanvasTexture(canvas);
grassTexture.wrapS = THREE.RepeatWrapping;
grassTexture.wrapT = THREE.RepeatWrapping;
grassTexture.repeat.set(40,40);
grassTexture.magFilter = THREE.NearestFilter;

let ground = new THREE.Mesh(
  new THREE.PlaneGeometry(100,100),
  new THREE.MeshLambertMaterial({ map: grassTexture })
);

ground.rotation.x = -Math.PI/2;
scene.add(ground);

/* ===== Floating Name ===== */
let loader=new THREE.FontLoader();
loader.load("https://threejs.org/examples/fonts/helvetiker_bold.typeface.json",font=>{
let geo=new THREE.TextGeometry("RUDVED",{
font:font,size:2,height:0.3
});
let mat=new THREE.MeshBasicMaterial({color:0xFFD700});
let text=new THREE.Mesh(geo,mat);
text.position.set(-6,9,-10);
scene.add(text);
});

/* ===== Cakes ===== */
let cakes=[];
let cakeOffsets=[];

for(let i=0;i<5;i++){
let cake=new THREE.Mesh(
new THREE.BoxGeometry(2,2,2),
new THREE.MeshLambertMaterial({color:0xFF1493})
);
cake.position.set((Math.random()-0.5)*40,2,(Math.random()-0.5)*40);
scene.add(cake);
cakes.push(cake);
cakeOffsets.push(Math.random()*Math.PI*2);
}

/* ===== Portal ===== */
let portal=new THREE.Mesh(
new THREE.TorusGeometry(3,0.5,12,60),
new THREE.MeshBasicMaterial({color:0x00FFFF})
);
portal.rotation.x=Math.PI/2;
portal.position.set(0,3,-25);
portal.visible=false;
scene.add(portal);

/* ===== Working Music (Reliable CDN) ===== */
let bgMusic = new Audio("https://cdn.jsdelivr.net/gh/jshawl/AudioFX/sounds/music/8bit.mp3");
bgMusic.loop = true;
bgMusic.volume = 0.5;

let winSound = new Audio("https://cdn.jsdelivr.net/gh/jshawl/AudioFX/sounds/success.mp3");
winSound.volume = 0.9;

/* ===== Confetti ===== */
let confetti=[];
function startConfetti(){
for(let i=0;i<150;i++){
let p=new THREE.Mesh(
new THREE.BoxGeometry(0.2,0.2,0.2),
new THREE.MeshBasicMaterial({color:Math.random()*0xffffff})
);
p.position.set((Math.random()-0.5)*30,15,(Math.random()-0.5)*30);
p.userData.speed=Math.random()*0.15+0.05;
scene.add(p);
confetti.push(p);
}
}

/* ===== Tap Handling ===== */
let raycaster=new THREE.Raycaster();
let mouse=new THREE.Vector2();
let gameWon=false;

function handleTap(e){

if(bgMusic.paused) bgMusic.play();

if(gameWon) return;

let rect=renderer.domElement.getBoundingClientRect();
let clientX=e.touches?e.touches[0].clientX:e.clientX;
let clientY=e.touches?e.touches[0].clientY:e.clientY;

mouse.x=((clientX-rect.left)/rect.width)*2-1;
mouse.y=-((clientY-rect.top)/rect.height)*2+1;

raycaster.setFromCamera(mouse,camera);
let intersects=raycaster.intersectObjects([...cakes,portal]);

if(intersects.length>0){
let obj=intersects[0].object;

if(cakes.includes(obj)){
scene.remove(obj);
cakes=cakes.filter(c=>c!==obj);
document.getElementById("cakeCount").innerText=cakes.length;

if(cakes.length===0){
portal.visible=true;
document.getElementById("instructions").innerHTML="‚ú® Tap the Glowing Portal!";
}
}
else if(obj===portal && portal.visible){
gameWon=true;
startConfetti();
winSound.play();
document.getElementById("inviteScreen").style.display="flex";
}
}
}

window.addEventListener("click",handleTap);
window.addEventListener("touchstart",handleTap);

/* ===== Animation ===== */
function animate(){
requestAnimationFrame(animate);

cakes.forEach((c,i)=>{
cakeOffsets[i]+=0.03;
c.position.y=2+Math.sin(cakeOffsets[i])*0.6;
});

if(portal.visible){
portal.scale.setScalar(1+Math.sin(Date.now()*0.004)*0.2);
}

confetti.forEach(p=>{
p.position.y-=p.userData.speed;
});

renderer.render(scene,camera);
}
animate();
</script>

</body>
</html>