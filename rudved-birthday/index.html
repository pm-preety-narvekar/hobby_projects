<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rudved's Minecraft Birthday Quest</title>

<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

<style>
html,body{
  margin:0;
  padding:0;
  overflow:hidden;
  background:#87CEEB;
  font-family:'Press Start 2P', cursive;
}

/* CENTERED UI */
#uiContainer{
  position:fixed;
  top:10px;
  width:100%;
  text-align:center;
  z-index:100;
  pointer-events:none;
}

#gameTitle{
  background:#000;
  color:#00ffcc;
  padding:10px;
  font-size:14px;
  display:inline-block;
}

#instructions{
  background:rgba(0,0,0,0.85);
  color:white;
  padding:6px;
  font-size:10px;
  margin-top:6px;
  display:inline-block;
}

#inviteScreen{
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:rgba(0,0,0,0.95);
  color:white;
  display:none;
  justify-content:center;
  align-items:center;
  flex-direction:column;
  text-align:center;
  z-index:200;
  padding:0 20px; 
  box-sizing:border-box;
}

/*#inviteScreen{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.95);
  display:none;

  // PERFECT CENTERING
  display:flex;
  justify-content:center;
  align-items:center;

  z-index:200;
}*/

#inviteCard{
  background:#111;
  border:4px solid #00ffcc;
  box-shadow:0 0 25px #00ffcc;

  padding:10px 10px;
  width:80%;
  max-width:500px;

  text-align:center;
  color:white;

  /* prevents edge sticking on very small screens */
  margin:20px;

  /* smooth pop look */
  transform:scale(1);
}
</style>
</head>
<body>

<div id="uiContainer">
  <div id="gameTitle">üéÆ RUDVED'S MINECRAFT BIRTHDAY QUEST üéÆ</div><br>
  <div id="instructions">üéÇ Tap All Jumping Cakes To Unlock Invitation!</div>
</div>

<div id="inviteScreen">
  <div id="inviteCard">
<h3>üéâ YOU ARE üéâ <br> üéâ INVITED üéâ</h3>
<h2>Rudved's <br><br>8th<br><br> Birthday!<br></h2>
<p>
üóì Saturday, 7th March<br><br>
‚è∞ 11:00 AM<br><br>
üéÆ Minecraft Fun Party
</p>
</div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128/examples/js/controls/OrbitControls.js"></script>

<script>

/* SCENE */

let scene = new THREE.Scene();
scene.background = new THREE.Color(0x87CEEB);

let renderer = new THREE.WebGLRenderer({ antialias:true });
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.setPixelRatio(window.devicePixelRatio);
renderer.shadowMap.enabled = true;
document.body.appendChild(renderer.domElement);

/* Allow gestures */
renderer.domElement.style.touchAction = "auto";

let camera = new THREE.PerspectiveCamera(
  60,
  window.innerWidth / window.innerHeight,
  0.1,
  1000
);

camera.position.set(0, 70, 140);
camera.lookAt(0,0,0);

/* CONTROLS */

let controls = new THREE.OrbitControls(camera, renderer.domElement);

controls.enableDamping = true;
controls.dampingFactor = 0.08;

controls.enableRotate = true;
controls.enableZoom = true;
controls.enablePan = true;

controls.minDistance = 60;
controls.maxDistance = 250;
controls.maxPolarAngle = Math.PI / 2.05;

controls.zoomSpeed = 1.2;
controls.rotateSpeed = 0.6;
controls.panSpeed = 0.6;

/* RESIZE */

window.addEventListener("resize",()=>{
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});

/* LIGHT */

scene.add(new THREE.AmbientLight(0xffffff,0.7));

let sun = new THREE.DirectionalLight(0xffffff,1);
sun.position.set(80,120,80);
sun.castShadow = true;
scene.add(sun);

/* GRASS TEXTURE */

let canvas = document.createElement("canvas");
canvas.width = 64;
canvas.height = 64;
let ctx = canvas.getContext("2d");

for(let y=0;y<8;y++){
  for(let x=0;x<8;x++){
    ctx.fillStyle = (Math.random()>0.5)?"#2ecc40":"#1e8c2f";
    ctx.fillRect(x*8,y*8,8,8);
  }
}

let texture = new THREE.CanvasTexture(canvas);
texture.wrapS = THREE.RepeatWrapping;
texture.wrapT = THREE.RepeatWrapping;
texture.repeat.set(30,30);
texture.magFilter = THREE.NearestFilter;

let ground = new THREE.Mesh(
  new THREE.BoxGeometry(180,10,180),
  [
    new THREE.MeshLambertMaterial({color:"#5a3d1e"}),
    new THREE.MeshLambertMaterial({color:"#5a3d1e"}),
    new THREE.MeshLambertMaterial({map:texture}),
    new THREE.MeshLambertMaterial({color:"#5a3d1e"}),
    new THREE.MeshLambertMaterial({color:"#5a3d1e"}),
    new THREE.MeshLambertMaterial({color:"#5a3d1e"})
  ]
);
ground.position.y = -5;
ground.receiveShadow = true;
scene.add(ground);

/* TREES */

function createTree(x,z){
  let trunk = new THREE.Mesh(
    new THREE.BoxGeometry(3,8,3),
    new THREE.MeshLambertMaterial({color:"#8B4513"})
  );
  trunk.position.set(x,4,z);
  trunk.castShadow = true;
  scene.add(trunk);

  for(let y=0;y<3;y++){
    for(let i=-1;i<=1;i++){
      for(let j=-1;j<=1;j++){
        if(Math.random()>0.2){
          let leaf = new THREE.Mesh(
            new THREE.BoxGeometry(4,4,4),
            new THREE.MeshLambertMaterial({color:"#1e8c2f"})
          );
          leaf.position.set(x+i*4,12+y*4,z+j*4);
          leaf.castShadow = true;
          scene.add(leaf);
        }
      }
    }
  }
}

for(let i=0;i<40;i++){
  let x=(Math.random()-0.5)*160;
  let z=(Math.random()-0.5)*160;
  if(Math.abs(x)<25 && Math.abs(z)<25) continue;
  createTree(x,z);
}

/* CAKES */

let cakes=[];
let raycaster = new THREE.Raycaster();
let mouse = new THREE.Vector2();
let particles=[];

function createCake(x, z) {
  let cakeGroup = new THREE.Group();

  /* CAKE BASE (Brown Sponge) */
  let base = new THREE.Mesh(
    new THREE.BoxGeometry(6, 3, 6),
    new THREE.MeshLambertMaterial({ color: "#b5651d" })
  );
  base.position.y = 1.5;
  base.userData.parentCake = cakeGroup;  // << link to group
  cakeGroup.add(base);

  /* ICING TOP (White Layer) */
  let icing = new THREE.Mesh(
    new THREE.BoxGeometry(6.2, 1, 6.2),
    new THREE.MeshLambertMaterial({ color: "#ffffff" })
  );
  icing.position.y = 3.5;
  icing.userData.parentCake = cakeGroup;  // << link to group
  cakeGroup.add(icing);

  /* RED PIXEL TOPPINGS */
  for (let i = 0; i < 6; i++) {
    let cherry = new THREE.Mesh(
      new THREE.BoxGeometry(0.8, 0.8, 0.8),
      new THREE.MeshLambertMaterial({ color: "#cc0000" })
    );

    cherry.position.set(
      (Math.random() - 0.5) * 4,
      4.2,
      (Math.random() - 0.5) * 4
    );
    cherry.userData.parentCake = cakeGroup;  // << link to group
    cakeGroup.add(cherry);
  }

  cakeGroup.position.set(x, 0, z);
  cakeGroup.userData.offset = Math.random() * Math.PI * 2;

  scene.add(cakeGroup);
  cakes.push(cakeGroup);
}

for(let i=0;i<6;i++){
  createCake((Math.random()-0.5)*80,(Math.random()-0.5)*80);
}

/* FIREWORK */

function burst(x,y,z,color){
  for(let i=0;i<50;i++){
    let cube = new THREE.Mesh(
      new THREE.BoxGeometry(0.7,0.7,0.7),
      new THREE.MeshBasicMaterial({color:color})
    );
    cube.position.set(x,y,z);
    cube.userData.velocity = new THREE.Vector3(
      (Math.random()-0.5)*2,
      Math.random()*2,
      (Math.random()-0.5)*2
    );
    scene.add(cube);
    particles.push(cube);
  }
}

/* TAP HANDLER */

function handleTap(event) {

  if(event.touches && event.touches.length > 1) return;

  let rect = renderer.domElement.getBoundingClientRect();
  let clientX = event.touches ? event.touches[0].clientX : event.clientX;
  let clientY = event.touches ? event.touches[0].clientY : event.clientY;

  mouse.x = ((clientX - rect.left) / rect.width) * 2 - 1;
  mouse.y = -((clientY - rect.top) / rect.height) * 2 + 1;

  raycaster.setFromCamera(mouse, camera);

  // INTERSECT WITH ALL CHILD MESHES OF CAKE GROUPS
  let intersects = [];
  cakes.forEach(cakeGroup => {
    intersects.push(...raycaster.intersectObjects(cakeGroup.children, true));
  });

  if (intersects.length > 0) {
    // get the parent cake group
    const cake = intersects[0].object.userData.parentCake || intersects[0].object;
    burst(cake.position.x, 10, cake.position.z, 0xffff00);

    // remove cake group
    scene.remove(cake);
    cakes = cakes.filter(c => c !== cake);

    if (cakes.length === 0) {
      setTimeout(() => {
        document.getElementById("inviteScreen").style.display = "flex";
      }, 1000);
    }
  }
}

renderer.domElement.addEventListener("touchstart",handleTap,{passive:true});
renderer.domElement.addEventListener("click",handleTap);

/* ANIMATION */

let clock = new THREE.Clock();

function animate(){
  requestAnimationFrame(animate);

  let time = clock.getElapsedTime();

  cakes.forEach(c=>{
    c.position.y = 3 + Math.abs(Math.sin(time*2 + c.userData.offset))*6;
  });

  particles.forEach((p,i)=>{
    p.position.add(p.userData.velocity);
    p.userData.velocity.y -= 0.05;
    if(p.position.y<0){
      scene.remove(p);
      particles.splice(i,1);
    }
  });

  controls.update();
  renderer.render(scene,camera);
}

animate();

</script>
</body>
</html>